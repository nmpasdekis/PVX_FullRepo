{"Category":"Pages","Access":["SuperAdmin"],"Controller":"[\"$scope\", \"$http\", \"webGL2\", \"$q\", function ($scope, $http, wgl, $q) { (async () =>{\n    let gl = await wgl(\"#webGLcanvas\");\n\n\tlet World = $scope.World = await fetchJs(\"/api/data/level.js\", gl);\n\n    let prevState={\n        \"MovingPoint\": \"EditPoints\",\n        \"EditPoints\": \"EditPoints\"\n    }\n    $scope.setState = function(s){\n        World.state=s;\n        World.Render();\n    }\n    $scope.createPoly = function(){\n        World.currentPoly = World.AddPolygon();\n        World.state = \"EditPoints\";\n    }\n    $scope.removePoly = function(i){\n        World.RemovePolygon(i);\n    }\n    $scope.selectPoly = function(i){\n        World.SelectPolygon(i);\n    }\n    $scope.selectPoint = function(i){\n        World.currentPoly.points.cur=i;\n        World.Render();\n    }\n    $scope.onMouseDown = function(e){\n        //console.log(state)\n        if(e.buttons&1){\n            if(World.currentPoly && World.state==\"EditPoints\") {\n                World.SelectPoint(World.currentPoly);\n                World.state=\"MovingPoint\";\n            }else{\n                World.RaySelectPoly();\n                World.SetState(null);\n            }\n        }\n    }\n    $scope.onMouseMove = function(e){\n        //console.log(state)\n        if(World.state==\"MovingPoint\" && e.buttons&1){\n            World.MovePoint(World.currentPoly);\n        }\n    }\n    $scope.onMouseUp = function(){\n        World.state = prevState[World.state];\n    }\n    $scope.zoom = function(e){\n        World.Zoom((1000 - e.wheelDelta)/1000.0, e);\n    }\n    $scope.SaveLevel = function(){\n        World.SaveLevel();\n    }\n})();}]","Html":"<style>\n    .webgl-card table{\n        border-collapse:collapse;\n        width: 100%;\n    }\n    .webgl-card .selected {\n        background-color:#6667ab;\n        color: white;\n    }\n    .webgl-card td{ padding: 5px 10px; }\n    .webgl-card .selectable td { cursor: pointer }\n</style>\n<md-card class=\"webgl-card\">\n    <md-toolbar class=\"md-table-toolbar md-default\" layout=\"row\">\n        <div class=\"md-toolbar-tools\">\n            <h2 class=\"text-center\">WebGL</h2>\n        </div>\n        <span flex></span>\n        <md-button class=\"md-raised md-warn\" ng-click=\"SaveLevel()\">Save</md-button>\n    </md-toolbar>\n    <md-card-content layout=\"row\">\n        <div ng-mousedown=\"onMouseDown($event)\" ng-mouseup=\"onMouseUp()\" ng-mousemove=\"onMouseMove($event)\" ng-mousewheel=\"zoom($event)\">\n            <canvas id=\"webGLcanvas\" width=\"1280\" height=\"720\" style=\"max-width:100%\"></canvas>\n        </div>\n        <div flex>\n            <md-button class=\"md-primary md-raised\" ng-click=\"createPoly()\">New Polygon</md-button>\n            <div style=\"padding:8px\">\n                <table class=\"selectable\" style=\"border:1px solid black\">\n                    <tr ng-repeat=\"p in World.Polygons\" ng-class=\"{selected:p==World.currentPoly}\">\n                        <td ng-dblclick=\"editText($event)\" ng-click=\"selectPoly($index)\">{{p.name}}</td>\n                        <td style=\"width:10px\"><i ng-click=\"removePoly($index)\" class=\"mdi mdi-close\"></i></td>\n                    </tr>\n                </table>\n                <pre>{{World.state}}</pre>\n                <div ng-if=\"World.currentPoly\">\n                    <md-button  ng-if=\"!['EditPoints','MovingPoint'].includes(World.state)\" ng-click=\"setState('EditPoints')\">Edit Polygon</md-button>\n                    <div ng-if=\"['EditPoints','MovingPoint'].includes(World.state)\">\n                        <h5>Points</h5>\n                        <table class=\"selectable\">\n                            <tr ng-click=\"selectPoint($index)\" ng-repeat=\"p in World.currentPoly.points\" ng-class=\"{selected:$index==World.currentPoly.points.cur}\">\n                                <!--<td>ob.Vertex({{p[0]}}, {{p[1]}}, {{p[2]}});</td>-->\n                                <td>[{{p[0]|number:2}},{{p[1]|number:2}},{{p[2]|number:2}}]</td>\n                            </tr>\n                        </table>\n                        <md-button ng-click=\"setState('null')\">Save</md-button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </md-card-content>\n    <md-card-actions>\n    \n    </md-card-actions>\n</md-card>","Name":"WebGL2"}